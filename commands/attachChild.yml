name: attachChild
description: |-
  Attaches a child object to a parent, similar to [[attachTo]] but instead of a rigid/forced attachment its using a PhysX joint.
  {{Feature|informative|For more information see {{Link|https://docs.nvidia.com/gameworks/content/gameworkslibrary/physx/guide/Manual/Joints.html|NVIDIA docs}}.}}
  Note that the joint parameters XYZ orientations, are according to the localFrame of the joint. swingZ/swingY/twist being Yaw/Roll/Pitch, can be changed if the joint itself is rotated, because the joint rotation moves the whole axis.

  {{Wiki|WIP}}
multiplayer_note: '{{Feature|important|This command does NOT behave well in Multiplayer.}}'
groups:
- PhysX
syntax:
- call: !Binary
  - - parent
    - child
  - - jointType
    - localFrameParent
    - localFrameChild
    - miscFlags
    - jointDescription
  ret:
  - Nothing
  - Do NOT depend on this staying nothing, it might change to be something.
  params:
  - name: parent
    description: the parent object that another object is attached to. Must be a Transport vehicle like Car/Tank (Maybe helicopter/airplane works?).
    type: Object
  - name: child
    description: the object being attached onto the parent. Must be a Transport vehicle like Car/Tank (Maybe helicopter/airplane works?).
    type: Object
  - name: jointType
    description: |-
      currently only "6DOFJoint" and "RevoluteJoint" and "FixedJoint"<br>

      <div class="_description">
      ; 6DOFJoint
      : Allows to configure all axis (XYZ translation, Pitch/Yaw/Roll rotation) limits and drives.
      ; RevoluteJoint
      : Only allows rotation around the X axis, a Revolute joint can also be implemented with a 6DOFJoint and the appropriate limits (internally it is implemented exactly like that)
      ; FixedJoint
      : Limited in all axis, it essentially works like a PhysX based attachTo.
      </div>
    type: String
  - name: localFrameParent
    description: |-
      the Position and orientation, in parent's model-space of where the joint will be placed.<br>
      An Array of 3 elements [position, upPos, dirPos]<br>
      Each element can either be a Vector (3-element array of [[Number]]) or a Memory point name ([[String]]).<br>
      <br>
      <br>
      An important Caveat when using Vectors is that dir and up are not direction vectors, but positions.<br>
      Essentially, upPos/dirPos would be the model-space coordinates of where the memory point would be.<br>
      For example:
      <sqf>
      private _jointPos = [0, 0, 0];
      private _vectorDir = [0, 1, 0];
      private _vectorUp = [0, 0, 1];
      [_jointPos, _jointPos vectorAdd _vectorDir, _jointPos vectorAdd _vectorUp];
      </sqf>
    type: ArrayUnknown
  - name: localFrameChild
    description: the position and orientation, in child's model-space of where the joint will be placed.
    type: ArrayUnknown
  - name: miscFlags
    description: |-
      [(collisionEnabled, breakForce)]

      <div class="_description">
      ;
      : collisionEnabled: [[Boolean]] (Optional, Default: [[false]]) - When false, disables collision between the two joint-ed objects
      ;
      : breakForce: [[Number]] (Optional, Default: -1)
      ;
      : limitsAreForces?
      </div>
    type: ArrayUnknown
    optional: true
  - name: jointDescription
    description: |-
      this specifies the behavior/limits of the joint.<br>
      [(linearLimit, swingLimit, twistLimit, drives)] <br><br>Note that all are optional. Passing an empty array is equivalent to using a "FixedJoint" type<br>
      <br>
      <div class="_description">
      ; linearLimit
      : [[Array]] - Linear limit specifies the joints permitted translation along the XYZ axis.<br>There are three types of linear limits, fully locked, per-axis limit and distance limit.<br><br><div class="_description">
      :; Fully Locked:
      :: []<br>Empty array, will completely lock the XYZ translational axes, only allowing rotational movement (If allowed in the swing/twist limits)
      :; Per axis:
      :: [limitX, limitY, limitZ]<br><div class="_description">
      ::; limit*:
      ::: [[Array]] - [lowerLimit, upperLimit, springParameters] <div class="_description">
      :::; lowerLimit:
      :::: [[Number]] - The minimum permitted offset on the axis
      :::; upperLimit:
      :::: [[Number]] - The maximum permitted offset on the axis<br> upperLimit must be larger than lowerLimit
      :::; springParameters:
      :::: [[Array]] - [(restitution, spring, damping)]<br>All spring parameters are optional, but for the linear limits, atleast an empty array must be provided. <div class="_description">
      ::::; restitiution:
      ::::: [[Number]] (Optional, Default: 0) - Must be between 0-1.<br> Controls the amount of bounce when the joint hits a limit.<br> A restitution value of 1.0 causes the joint to bounce back with the velocity which it hit the limit.<br> A value of zero causes the joint to stop dead.<br> {{Link|https://docs.nvidia.com/gameworks/content/gameworkslibrary/physx/apireference/files/classPxJointLimitParameters.html#cf208a0f1e54fb8e9219af1e0357d4a9|NVIDIA docs}}
      ::::; spring:
      ::::: [[Number]] (Optional, Default: 0) - Must be 0 or greater.<br> if greater than zero, the limit is soft, i.e. a spring pulls the joint back to the limit
      ::::; damping:
      ::::: [[Number]] (Optional, Default: 0) - Must be 0 or greater. if spring is greater than zero, this is the damping of the limit spring</div>
      ::; Distance Limit
      ::: [xLocked, yLocked, zLocked, distanceLimit, springParameters]<br> <div class="_description">
      :::; *Locked:
      :::: [[Boolean]] - Whether the axis is completely locked and no translation is allowed along it
      :::; distanceLimit:
      :::: [[Number]] - Distance on meters, as a radius/sphere around the joint.
      :; swingLimit:
      :: [[Array]] - [(swingX, swingZ, springParameters)]<br>All parameters are optional, the default is both swing axis being locked<br>Swing limit comes in two types, cone and pyramid. Which variant is used depends on the datatype inside the swing parameter<br>Note that cone cannot be combined with pyramid, either both are cone or both are pyramid.<br>If the swing limit is [[pi]], the rotation around that axis is fully unlocked/free.<div class="_description">
      ::; Cone limit:
      ::: swingZ: [[Number]] (Optional, Default 0/locked) - The rotation around the Z (up) axis, thus the yaw. Rotation in radians, between [[pi]] and [[pi]].
      ::;
      ::: swingY: [[Number]] (Optional, Default 0/locked) - The rotation around the Y (front/dir) axis, thus the roll. Rotation in radians, between [[pi]] and [[pi]].
      ::; Pyramid limit:
      ::: swingZ: [[Array]] - [(min, max)] - Same rotation in radians as the cone limit, but it can be asymmetrical.
      ::;
      ::: swingY:  [[Array]] - [(min, max)] - Same rotation in radians as the cone limit, but it can be asymmetrical.
      :; twistLimit:
      :: [[Array]] - [(twistLower, twistUpper, springParameters)]<br>Twist is rotation about the X (right) axis, thus the pitch.<br>Left and right twist limits can be configured independently.<br><div class="_description">
      ::; twist*:
      ::: [[Number]] (Optional, Default: 0) - Rotation limit in radians, between -2[[pi]] and 2[[pi]]<br> 0 means twist is locked, and 2*pi means its completely unlocked
      :; drives:
      :: [[Array]] - [(angularSwingDrive, angularTwistDrive, angularSlerpDrive, linearXDrive, linearYDrive, linearZDrive, limitsAreForces)]<br>Drives allow to apply force into the joint on any of the axes.<br>Each drive is a spring, one end being on the joint, and the other end being on the target specified by the commands:<br>[[setJointDrivePosition]] [[setJointDriveOrientation]] [[setJointDriveLinearVelocity]] [[setJointDriveAngularVelocity]]<br>For rotational drives there are two variants, Swing+Twist or SLERP (Spherical Linear Interpolation)<br>See {{Link|https://docs.nvidia.com/gameworks/content/gameworkslibrary/physx/guide/Manual/Joints.html#drives|NVIDIA docs}}<div class="_description">
      ::; *Drive:
      ::: [[Array]] - [type, spring, damping, forceLimit]<div class="_description">
      :::; type:
      :::: [[Number]] - MUST be 0 (#TODO acceleration drive implementation?)<br>
      :::; spring:
      :::: [[Number]] - Same as springParameters above
      :::; damping:
      :::: [[Number]] - Same as springParameters above
      :::; forceLimit:
      ::::  [[Number]] - The maximum force this drive c an apply to the joint
      :; limitsAreForces:
      :: [[Boolean]] (Optional, Default: true) - NOT IMPLEMENTED #TODO?</div>
    type: ArrayUnknown
    optional: true
argument_loc: Local
effect_loc: Global
server_exec: false
since:
  arma_3:
    major: 2
    minor: 22
examples:
- "Attach a Quad (varname towbar) to a HEMTT (varName vParent) and another HEMTT (varName vChild) to the Quad.\nEssentially using the Quad as a \"towbar\":\n<sqf>\n_parentPos = [0, -5, 0]; // position on the hemtt\n_childPos = [0, 1, -0.2]; // position on the quad\n\n_jointDescription =\n[\n// Limits\n\t// Linear\n\t[], // Default is locked\n\n\t// Swing\n\t// [swing1 yaw, swing2 roll, springParams]\n\t[\n\t\trad 45, // yaw\n\t\t0 // roll\n\t],\n\t// Twist pitch\n\t// [twistLower, twistUpper, springParams]\n\t[rad -20, rad 20], // Default is locked\n\n// Drives\n\t[] // Default are none\n];\n\n_params = [\n\t\"6DOFJoint\",\n\t// From [pos,dir,up]\n\t[_parentPos, _parentPos vectorAdd [0, 1, 0], _parentPos vectorAdd [0, 0, 1]],\n\t// To [pos,dir,up]\n\t[_childPos, _childPos vectorAdd [0, 1, 0], _childPos vectorAdd [0, 0, 1]],\n\t// misc [collisions enabled]\n\t[false],\n\t_jointDescription\n];\n\n[vParent, towBar] attachChild _params;\n\n_parentPos = [0, -1, -0.2]; // Position on the quad\n_childPos = [0, 5, 0]; // Position on the hemtt\n\n_params = [\n\t\"6DOFJoint\",\n\t// From [pos,dir,up]\n\t[_parentPos, _parentPos vectorAdd [0, 1, 0], _parentPos vectorAdd[0, 0, 1]],\n\t// To [pos,dir,up]\n\t[_childPos, _childPos vectorAdd [0, 1, 0], _childPos vectorAdd [0, 0, 1]],\n\t// misc [collisions enabled]\n\t[false],\n\t_jointDescription\n];\n\n[towBar, vChild] attachChild _params;\n</sqf>"
- "Attach a Quad (varname towbar) to a HEMTT (varName vParent) and another HEMTT (varName vChild) to the Quad.\nBut we rotate the axis so that Swing's are Pitch/Yaw and Twist is roll\n<sqf>\n_parentPos = [0, -5, 0]; // position on the hemtt\n_childPos = [0, 1, -0.2]; // position on the quad\n\n_jointDescription =\n[\n// Limits\n\t// Linear\n\t[], // Default is locked\n\n\t// Swing\n\t// [swing1 pitch, swing2 yaw, springParams]\n\t[\n\t\trad 20, // pitch\n\t\trad 45 // yaw\n\t],\n\t// Twist roll\n\t// [twistLower, twistUpper, springParams]\n\t[], // Default is locked\n\n// Drives\n\t[] // Default are none\n];\n\n_params = [\n\t\"6DOFJoint\",\n\t// From [pos,dir,up]\n\t[_parentPos, _parentPos vectorAdd [0, 0, 1], _parentPos vectorAdd [1, 0, 0]], // Note how the up is pointing right and forward is pointing down, we are rotating the whole joint\n\t// To [pos,dir,up]\n\t[_childPos, _childPos vectorAdd [0, 0, 1], _childPos vectorAdd [1, 0, 0]],\n\t// misc [collisions enabled]\n\t[false],\n\t_jointDescription\n];\n\n[vParent, towBar] attachChild _params;\n\n_parentPos = [0, -1, -0.2]; // Position on the quad\n_childPos = [0, 5, 0]; // Position on the hemtt\n\n_params = [\n\t\"6DOFJoint\",\n\t// From [pos,dir,up]\n\t[_parentPos, _parentPos vectorAdd [0, 0, 1], _parentPos vectorAdd [1, 0, 0]],\n\t// To [pos,dir,up]\n\t[_childPos, _childPos vectorAdd [0, 0, 1], _childPos vectorAdd [1, 0, 0]],\n\t// misc [collisions enabled]\n\t[false],\n\t_jointDescription\n];\n\n[towBar, vChild] attachChild _params;\n</sqf>"
