name: lineIntersectsSurfaces
desc: |-
  Returns a list of intersections with surfaces and ground from ''begPosASL'' to ''endPosASL''. Doesn't return intersection with sea surface. Works underwater, unlike [[lineIntersects]]. Hardcoded max distance: 5000m.
  {{Feature|important|
  * if ''begPosASL'' is under the ground and ''endPosASL'' is above it, the command will only return intersection with the ground, this is an engine limitation and none of the intersectXXX commands will work when initiated from under the ground.
  * only a single LOD is checked for intersection. LOD2 will only be checked if LOD1 is unavailable.
  }}
  Since {{GVI|arma3|2.20|size= 0.75}}, there is an alternative syntax that does multiple checks in parallel, faster than multiple calls.
groups:
- Math - Geometry
syntax:
- call: !Unary
  - begPosASL
  - endPosASL
  - ignoreObj1
  - ignoreObj2
  - sortMode
  - maxResults
  - LOD1
  - LOD2
  - returnUnique
  ret:
    type: Unknown
  params:
  - name: begPosASL
    desc: virtual line start
    type: Position3dASL
  - name: endPosASL
    desc: virtual line end
    type: Position3dASL
  - name: ignoreObj1
    desc: first object to ignore
    type: Object
    optional: true
    default: '[[objNull]]'
  - name: ignoreObj2
    desc: second object to ignore
    type: Object
    optional: true
    default: '[[objNull]]'
  - name: sortMode
    desc: '[[true]]: closest to furthest, [[false]]: furthest to closest'
    type: Boolean
    optional: true
    default: '[[true]]'
  - name: maxResults
    desc: max results to return. -1 to return every result
    type: Number
    optional: true
    default: '1'
  - name: LOD1
    type: !StringEnum
    - value: FIRE
      desc: null
      since: null
    - value: VIEW
      desc: null
      since: null
    - value: GEOM
      desc: null
      since: null
    - value: IFIRE
      desc: null
      since: null
    - value: NONE
      desc: null
      since: null
    - value: PHYSX
      desc: null
      since:
        arma3: '2.2'
    - value: ROADWAY
      desc: null
      since:
        arma3: '2.8'
    optional: true
    since:
      arma3: '1.52'
  - name: LOD2
    desc: secondary [[LOD]] to look for intersection. See ''LOD1'' for possible values
    type: String
    optional: true
    default: '"FIRE"'
    since:
      arma3: '1.52'
  - name: returnUnique
    desc: when [[false]], all intersections in the same object are included, otherwise only the first one
    type: Boolean
    optional: true
    default: '[[true]]'
    since:
      arma3: '1.70'
- call: !Unary
  - - element1
    - element2
    - '...'
  ret:
    type: Unknown
  params:
  - name: elementN
    type: Unknown
  since:
    arma3: '2.20'
argument_loc: Global
effect_loc: Unspecified
since:
  arma3: '1.50'
examples:
- <sqf>_intersections = lineIntersectsSurfaces [eyePos player, aimPos chopper, player, chopper, true, -1];</sqf>
- "<sqf>\narrow = \"Sign_Arrow_F\" createVehicle [0,0,0];\nonEachFrame {\n\t_ins = lineIntersectsSurfaces [\n\t\tAGLToASL positionCameraToWorld [0,0,0], \n\t\tAGLToASL positionCameraToWorld [0,0,1000], \n\t\tplayer\n\t];\n\tif (count _ins == 0) exitWith { arrow setPosASL [0,0,0] };\n\tarrow setPosASL (_ins select 0 select 0);\n\tarrow setVectorUp (_ins select 0 select 1);\n\thintSilent str _ins;\n};\n</sqf>"
- "This should detect glass windows and wire fences (since {{arma3}} v1.52):\n<sqf>\nwirefence = \"Land_New_WiredFence_5m_F\" createVehicle position player;\narrow = \"Sign_Arrow_F\" createVehicle [0,0,0];\nonEachFrame {\n\t_ins = lineIntersectsSurfaces [\n\t\tAGLToASL positionCameraToWorld [0,0,0], \n\t\tAGLToASL positionCameraToWorld [0,0,1000], \n\t\tplayer,\n\t\tobjNull,\n\t\ttrue,\n\t\t1,\n\t\t\"GEOM\",\n\t\t\"NONE\"\n\t];\n\tif (count _ins == 0) exitWith { arrow setPosASL [0,0,0] };\n\tarrow setPosASL (_ins select 0 select 0);\n\tarrow setVectorUp (_ins select 0 select 1);\n\thintSilent str _ins;\n};\n</sqf>"
- "Alternative syntax to check intersections in parallel. Will draw a redline to the first intersecting object between the player and unit:\n<sqf>\nprivate _handle = addMissionEventHandler [\"Draw3D\", {\n\tprivate _enemies = units opfor;\n\tprivate _enemyDataArray = _enemies apply { [eyePos player, eyePos _x, player, _x] };\n\t\n\tprivate _intersections = lineIntersectsSurfaces [_enemyDataArray];\n\t{\n\t\t// No intersections found, draw green '+' icon at unit\n\t\tif (_x isEqualTo []) then {\n\t\t\tdrawIcon3D [\n\t\t\t\t\"\\a3\\ui_f\\data\\gui\\cfg\\cursors\\add_gs.paa\",\n\t\t\t\t[0, 1, 0, 1],\n\t\t\t\tASLToAGL (eyePos (_enemies#_forEachIndex)),\n\t\t\t\t0.5, 0.5, 0,\n\t\t\t\tstr (_enemies#_forEachIndex)\n\t\t\t];\n\t\t} else {\n\t\t\tprivate _firstIntersection = _x#0;\n\t\t\t// Draw red line and '+' icon to first intersecting object\n\t\t\tdrawIcon3D [\n\t\t\t\t\"\\a3\\ui_f\\data\\gui\\cfg\\cursors\\add_gs.paa\",\n\t\t\t\t[1, 0, 0, 1],\n\t\t\t\tASLToAGL (_firstIntersection#0),\n\t\t\t\t0.5, 0.5, 0,\n\t\t\t\tstr (_enemies#_forEachIndex) + \"- Blocked by \" + str (_firstIntersection#2)\n\t\t\t];\n\t\t\tdrawLine3D [\n\t\t\t\tASLToAGL (eyePos player),\n\t\t\t\tASLToAGL (_firstIntersection#0),\n\t\t\t\t[1, 0, 0, 1],\n\t\t\t\t5\n\t\t\t];\n\t\t};\n\t} forEach _intersections;\n}];\n</sqf>"
see_also:
- lineIntersectsObjs
- lineIntersectsWith
- lineIntersects
- terrainIntersectASL
- terrainIntersectAtASL
- terrainIntersect
- intersect
- cursorObject
- cursorTarget
- checkVisibility
